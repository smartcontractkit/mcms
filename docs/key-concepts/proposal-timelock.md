# RBAC TimeLock Proposal Format

The **MCMS + Timelock Implementation** is an extended proposal format designed for teams that incorporate
RBACTimelock as part of their contract ownership structure. It builds upon the base MCMS proposal structure by adding
timelock configurations and operations like scheduling, cancelling, or bypassing transactions.

### General Considerations

- **Timelock Configurations**: Timelocks allow delaying the execution of transactions, giving signers time to review
  and, if necessary, cancel operations.
- **Batching**: Transactions can be grouped into batches to be executed together, ensuring atomicity.
- **Parallel Signing**: The nonce offset helps manage nonces when signing transactions across different chains
  simultaneously.
- **Human-Readable Breadcrumbs**: Non-signed metadata such as `contractType` and `tags` can be used to give additional
  context to the operations, especially during debugging or reviews. Included in both timelock and non-timelock proposal
  types.

# MCMS + Timelock Proposal Format

<!-- panels:start -->

<!-- div:left-panel -->

### JSON Proposal Structure

```json
{
  "version": "<PROPOSAL_FORMAT_VERSION>",
  "operation": "<schedule | cancel | bypass>",
  "validUntil": "<UINT256_TIMESTAMP>",
  "minDelay": "24h",
  "description": "<Human-readable (but generated) description>",
  "signatures": [
    "<SIGNATURE_ONE>",
    "<SIGNATURE_TWO>",
    "<SIGNATURE_THREE>"
  ],
  "chain_metadata": {
    "<CHAIN_SELECTOR>": {
      "startingOpCount": "<offset>",
      "mcmAddress": "<MCM_ADDRESS>",
      "timelockAddress": "<TIMELOCK_ADDRESS>"
    }
  },
  "transactions": [
    {
      "chain": "<CHAIN_SELECTOR>",
      "to": "<TARGET_CONTRACT>",
      "payload": "<HEX_PAYLOAD>",
      "value": "<ETHER_TO_TRANSFER>",
      "contractType": "<CONTRACT_TYPE>",
      "tags": [
        "<sometag>"
      ]
    },
    {
      "chain": "<CHAIN_SELECTOR>",
      "batch": [
        {
          "to": "<TARGET_CONTRACT>",
          "payload": "<HEX_PAYLOAD>",
          "value": "<ETHER_TO_TRANSFER>",
          "contractType": "<CONTRACT_TYPE>"
        },
        {
          "to": "<TARGET_CONTRACT>",
          "payload": "<HEX_PAYLOAD>",
          "value": "<ETHER_TO_TRANSFER>",
          "contractType": "<CONTRACT_TYPE>"
        }
      ]
    }
  ]
}
```

<!-- div:right-panel -->

### Field Descriptions & General Considerations

- **version**: Identifies the format version of the proposal to ensure compatibility.

- **operation**: Specifies the high-level action for the proposal. Can be one of:
    - `schedule`: Sets up transactions to execute after a delay.
    - `cancel`: Cancels previously scheduled transactions.
    - `bypass`: Directly executes transactions, skipping the timelock.

- **validUntil**: A timestamp indicating the expiration of the proposal, after which it cannot be executed.

- **minDelay**: The delay duration that applies to all transactions, ensuring that they are held in the timelock for the
  specified time.

- **description**: A human-readable description generated by the proposal author to give signers context for the
  operations.

- **signatures**: A list of signatures from signers who approve the proposal.

- **chain_metadata**: Chain-specific configuration for the proposal:
    - **CHAIN_SELECTOR**: The blockchain chain selector ID, a `uin64` value matching the chain based on
      the [Chain Selectors Repo Structure](https://github.com/smartcontractkit/chain-selectors)
    - **startingOpCount**: A value used for parallel signing to manage nonces across multiple chains.
    - **mcmAddress**: The address of the MCM contract on the respective chain.
    - **timelockAddress**: The address of the timelock contract on the respective chain.

- **transactions**: Contains the list of transactions or batches to be executed:
    - **chain**: The chain identifier where the transaction will be executed.
    - **to**: The target contract address.
    - **payload**: The hexadecimal payload to send to the contract.
    - **additionalFields**: A chain-specific object with data relevant for the execution of operations on each chain.
    - **contractType** (optional): The type of contract, potentially pointing to an ABI or other metadata.
    - **tags** (optional): Tags for categorizing or describing transactions.

- **batch**: In some cases, multiple transactions are grouped into a batch to be executed atomically. Each transaction
  in the batch has the same fields as a regular transaction (e.g., `to`, `payload`, `value`).

<!-- panels:end -->